(this.webpackJsonpreactthree=this.webpackJsonpreactthree||[]).push([[0],{114:function(e,t,n){},115:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(24),l=n.n(o),c=(n(65),n(7)),i=n(12),s=n(9),u=n(8),m=n(10),d=(n(66),n(4)),h=function(e){return r.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-light bg-light"},r.a.createElement(d.b,{className:"navbar-brand",to:"#"},e.user.name),r.a.createElement("button",{className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbarNavAltMarkup","aria-controls":"navbarNavAltMarkup","aria-expanded":"false","aria-label":"Toggle navigation"},r.a.createElement("span",{className:"navbar-toggler-icon"})),r.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarNavAltMarkup"},r.a.createElement("div",{className:"navbar-nav"},r.a.createElement(d.b,{className:"nav-item nav-link active",to:"/movie"},"Movie ",r.a.createElement("span",{className:"sr-only"},"(current)")),e.user?r.a.createElement(r.a.Fragment,null,r.a.createElement(d.b,{className:"nav-item nav-link",to:"/profile"},e.user.name," "),r.a.createElement(d.b,{className:"nav-item nav-link",to:"/login",onClick:function(e){localStorage.removeItem("token"),window.location="/login"}},"Logout")):r.a.createElement(r.a.Fragment,null,r.a.createElement(d.b,{className:"nav-item nav-link",to:"/login"},"Login "),r.a.createElement(d.b,{className:"nav-item nav-link",to:"/register"},"Register")),r.a.createElement(d.b,{className:"nav-item nav-link",to:"#"},"Pricing"),r.a.createElement(d.b,{className:"nav-item nav-link disabled",to:"#"},"Disabled"))))},g=n(17);var p=function(e){return r.a.createElement("i",{className:e.like?"fas fa-star":"far fa-star",onClick:function(){e.starClick(e.movie)},style:{color:"orange",fontSize:30,cursor:"pointer"}})},f=function(e){var t=e.contentArr.filter((function(t){return"All"===e.currentGenres?t:e.currentGenres===t.genres.name?t:null})),n=(e.pageSize,e.currentGenres,Math.ceil(t.length/e.pageSize)),a=Number(e.currentPage)>n?n:Number(e.currentPage);return r.a.createElement("nav",{"aria-label":"Page navigation example"},r.a.createElement("ul",{className:"pagination"},r.a.createElement("li",{className:"page-item",onClick:function(){e.pagingClick(a-1||1)}},r.a.createElement("a",{className:"page-link"},"Previous")),function(){for(var t=[],o=function(n){t.push(r.a.createElement("li",{key:n,className:a===n?"page-item active":"page-item",onClick:function(){e.pagingClick(n)}},r.a.createElement("a",{className:"page-link",style:{cursor:"pointer"}},n)))},l=1;l<=n;l++)o(l);return t}(),r.a.createElement("li",{className:"page-item",onClick:function(){e.pagingClick(a+1>n?n:a+1)}},r.a.createElement("a",{className:"page-link"},"Next"))))},v=function(e){var t=e.allGenres;(function(){var t=[];e.contentArr.forEach((function(e){t.push(e.genres.name)})),t.sort().filter((function(e,t,n){return!t||e!==n[t-1]}))})(),e.currentGenres;return r.a.createElement(r.a.Fragment,null,r.a.createElement("ul",{className:"list-group",style:{cursor:"pointer"}},r.a.createElement("li",{className:"All"===e.currentGenres?"list-group-item active":"list-group-item",onClick:function(){e.genresClick("All")}},"Genres"),t.map((function(t,n){return r.a.createElement("li",{key:n,className:e.currentGenres===t?"list-group-item active":"list-group-item ",onClick:function(){e.genresClick(t)}},t)}))))},b=function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("i",{className:"fas fa-long-arrow-alt-down",style:{fontSize:"20px"},onClick:function(){e.sortClick(e.colName)}}),r.a.createElement("i",{className:"fas fa-long-arrow-alt-up",style:{fontSize:"20px"},onClick:function(){e.sortClick(e.colName)}}))},E=function(e){var t=e.contentArr.filter((function(t){return"All"===e.currentGenres?t:e.currentGenres===t.genres.name?t:null})),n=e.pageSize,o=(e.currentGenres,Math.ceil(t.length/e.pageSize)),l=Number(e.currentPage)>o?o:Number(e.currentPage);return r.a.createElement(a.Fragment,null,r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("h5",{className:"my-3",style:{fontSize:20}},"Showing ",t.length," movies"),r.a.createElement("table",{className:"table text-center"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{scope:"col"},"#"),r.a.createElement("th",{scope:"col"},"Tittle\xa0\xa0\xa0\xa0",r.a.createElement(b,{sortClick:e.sortClick,colName:"tittle"})),r.a.createElement("th",{scope:"col"},"Genres \xa0\xa0\xa0\xa0",r.a.createElement(b,{sortClick:e.sortClick,colName:"genres"})),r.a.createElement("th",{scope:"col"},"Stock \xa0\xa0\xa0\xa0",r.a.createElement(b,{sortClick:e.sortClick,colName:"stock"})),r.a.createElement("th",{scope:"col"},"Like"),e.user.isAdmin&&r.a.createElement("th",{scope:"col"},"Button"))),r.a.createElement("tbody",null,t.map((function(t,n){return r.a.createElement("tr",{key:n},r.a.createElement("th",{scope:"row"},n+1),r.a.createElement("td",null,r.a.createElement(d.b,{to:"/movie/"+t._id}," ",t.tittle)),r.a.createElement("td",null," ",t.genres.name," "),r.a.createElement("td",null," ",t.stock," "),r.a.createElement("td",null,r.a.createElement(p,{like:t.like,starClick:e.starClick,movie:t})),e.user.isAdmin&&r.a.createElement("td",null,r.a.createElement("button",{onClick:function(){e.click(t)},className:"btn btn-danger"},"Delete")))})).slice((l-1)*n,(l-1)*n+n))))))},k=n(6),N=n.n(k),S=function(e){return r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:e.name},e.label),r.a.createElement("input",{value:e.value,onChange:e.handleChange,name:e.name,type:e.type,className:"form-control",id:e.name}),e.error&&r.a.createElement("div",{className:"alert alert-danger "},e.error))},y=function(e){return r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{style:{marginTop:10},className:"form-control",onChange:e.handleSearch,value:e.searchValue}))},C=n(21),w=n.n(C),j=n(3);w.a.defaults.headers.common["x-auth-token"]=localStorage.getItem("token")||"a",w.a.interceptors.response.use((function(e){return Promise.resolve(e)}),(function(e){return j.b.error(e.response.data),Promise.reject(e)}));var O={get:w.a.get,post:w.a.post,delete:w.a.delete,put:w.a.put};n(34);var G={getGenres:function(){return O.get("http://localhost:3900/api/genres").then((function(e){return e.data.map((function(e){return e.name}))})).catch((function(e){return j.b.info("cannot get single movie"),Promise.reject(e)}))},getGenreId:function(e){return O.get("http://localhost:3900/api/genres").then((function(t){return t.data.find((function(t){return t.name===e}))})).catch((function(e){return j.b.info("cannot get single movie"),Promise.reject(e)}))}};var P={getMovies:function(){return O.get("http://localhost:3900/api/movies").then((function(e){return e.data.map((function(e){return{_id:e._id,tittle:e.title,stock:e.numberInStock,genres:e.genre,dailyRentalRate:e.dailyRentalRate}}))})).catch((function(e){return j.b.info("cannot get all movies"),Promise.reject(e)}))},deleteMovie:function(e){return O.delete("http://localhost:3900/api/movies/".concat(e)).then((function(e){return j.b.info("deleted"),Promise.resolve(e)})).catch((function(e){return j.b.info("cannot delete"),Promise.reject(e)}))},getMovie:function(e){return O.get("http://localhost:3900/api/movies/".concat(e)).then((function(e){return{_id:e.data._id,tittle:e.data.title,stock:e.data.numberInStock,genres:e.data.genre,dailyRentalRate:e.data.dailyRentalRate}})).catch((function(e){return j.b.info("cannot get single movie"),Promise.reject(e)}))},postMovie:function(e){return G.getGenreId(e.genre).then((function(t){return console.log(t._id),{title:e.title,numberInStock:e.stock,dailyRentalRate:e.rate,genreId:t._id}})).then((function(e){return O.post("http://localhost:3900/api/movies/",e)})).then((function(e){return e})).catch((function(e){return j.b.info("canot post a new movie"),Promise.reject(e)}))},updateMovie:function(e){return console.log(e.id),G.getGenreId(e.genre).then((function(t){return{title:e.title,numberInStock:e.stock,dailyRentalRate:e.rate,genreId:t._id}})).then((function(t){return console.log(t),O.put("http://localhost:3900/api/movies/".concat(e.id),t)})).then((function(e){return e})).catch((function(e){return j.b.info("cannot update movie"),Promise.reject(e)}))}},A=(n(88),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).componentWillMount=function(){P.getMovies().then((function(e){n.setState((function(t){return t.movies=e}))})),G.getGenres().then((function(e){n.setState((function(t){return t.allGenres=e}))}))},n.click=function(e){console.log(e._id);var t=n.state.movies;n.setState((function(t){return t.movies=t.movies.filter((function(t){return t._id!==e._id}))})),P.deleteMovie(e._id).catch((function(e){n.setState((function(e){return e.movies=t}))}))},n.starClick=function(e){n.setState((function(t){return t.movies=t.movies.map((function(t){return t===e?Object(g.a)({},t,{},{like:!t.like}):t}))}))},n.pagingClick=function(e){n.setState((function(t){return t.currentPage=e}))},n.genresClick=function(e){P.getMovies().then((function(t){var a=t.filter((function(t){return"All"===e?t:t.genres.name===e}));n.setState((function(t){return t.currentGenres=e,t.movies=a,t}))}))},n.sortClick=function(e){console.log(e);var t=[];t=n.state.sortOrder===e?n.state.movies.reverse():n.state.movies.sort((function(t,n){return"genres"===e?t[e].name>n[e].name?-1:t[e].name===n[e].name?0:1:t[e]>n[e]?-1:t[e]===n[e]?0:1})),n.setState((function(n){return n.sortOrder=e,n.movies=t}))},n.handleSearch=function(e){var t=e.currentTarget.value,a=new RegExp("^.*".concat(t,".*$"),"i");P.getMovies().then((function(e){var r=e.filter((function(e){return e.tittle.match(a)?e:null}));n.setState((function(e){return e.movies=r,e.currentGenres="All",e.searchValue=t}))}))},n.state={movies:[],pageSize:3,currentPage:1,currentGenres:"All",sortOrder:"xxx",searchValue:"",allGenres:[""]},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(j.a,null),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-sm-12 col-md-2 my-5 text-center"},r.a.createElement(v,{contentArr:this.state.movies,allGenres:this.state.allGenres,genresClick:this.genresClick,currentGenres:this.state.currentGenres})),r.a.createElement("div",{className:"col-9"},this.props.user&&r.a.createElement(d.b,{className:"btn btn-primary mt-5 mb-2",to:"/movie/new"},"New movie"),r.a.createElement(y,{handleSearch:this.handleSearch,searchValue:this.state.searchValue}),r.a.createElement(E,{contentArr:this.state.movies,pageSize:this.state.pageSize,currentPage:this.state.currentPage,currentGenres:this.state.currentGenres,starClick:this.starClick,pagingClick:this.pagingClick,click:this.click,sortClick:this.sortClick,user:this.props.user}),r.a.createElement(f,{contentArr:this.state.movies,pageSize:this.state.pageSize,currentPage:this.state.currentPage,currentGenres:this.state.currentGenres,starClick:this.starClick,pagingClick:this.pagingClick,click:this.click}))))}}]),t}(a.Component)),I=function(e){return r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:e.name},e.label),r.a.createElement("select",{className:"form-control",onChange:e.handleChange,name:e.name,id:e.name,value:e.value},r.a.createElement("option",{value:"DEFAULT",disabled:!0}," -- select an option -- "),e.options.map((function(e,t){return r.a.createElement("option",{value:e,key:t},e)})),r.a.createElement("option",null,"aaa")),e.error&&r.a.createElement("div",{className:"alert alert-danger "},e.error))},M=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).handleChange=function(e){var t=Object(g.a)({},n.state.data),a=Object(g.a)({},n.state.error);t[e.currentTarget.name]=e.currentTarget.value,a[e.currentTarget.name]=n.validateProperty(e),n.setState((function(e){return e.data=t,e.error=a,e}))},n.validateProperty=function(e){var t=N.a.validate(e.currentTarget.value,n.schema[e.currentTarget.name],{abortEarly:!1});return t.error?t.error.details[0].message:null},n.validate=function(){var e=N.a.validate(n.state.data,n.schema,{abortEarly:!1});if(!e.error)return!1;var t={},a=!0,r=!1,o=void 0;try{for(var l,c=e.error.details[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var i=l.value;t[i.path[0]]=i.message}}catch(s){r=!0,o=s}finally{try{a||null==c.return||c.return()}finally{if(r)throw o}}return t},n.handleSubmit=function(e){e.preventDefault(),n.setState((function(e){return e.error=n.validate()})),n.doSubmit()},n.renderButton=function(e){return r.a.createElement("button",{disabled:n.validate(),onClick:n.handleSubmit,className:"btn btn-primary"},e)},n.renderInput=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text";return r.a.createElement(S,{value:n.state.data[e],handleChange:n.handleChange,name:e,type:a,label:t,className:"form-control",id:e,error:n.state.error[e]})},n.renderSelect=function(e,t,a,o){return r.a.createElement(I,{name:e,label:t,value:o,options:a,id:e,handleChange:n.handleChange,error:n.state.error[e]})},n}return Object(m.a)(t,e),t}(a.Component),R=n(25),x=n.n(R);n(91);var z={registerUser:function(e){return O.post("http://localhost:3900/api/users",{name:e.name,email:e.username,password:e.password}).then((function(e){return j.b.info("user registed"),localStorage.setItem("token",e.headers["x-auth-token"]),Promise.resolve(e)})).catch((function(e){return j.b.info("cannot register a new user"),Promise.reject(e)}))},loginUser:function(e){return O.post("http://localhost:3900/api/auth",{email:e.username,password:e.password}).then((function(e){return j.b.info("user logged"),localStorage.setItem("token",e.data),Promise.resolve(e)})).catch((function(e){return j.b.info("cannot login"),Promise.reject(e)}))},get isAuthed(){return Boolean(localStorage.getItem("token")?x()(localStorage.getItem("token")):"")}},_=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).state={data:{username:"aaa@aaa",password:"aaaaa"},error:{}},n.schema={username:N.a.string().min(3).required().label("Username"),password:N.a.string().required().label("Password")},n.doSubmit=function(){z.loginUser(n.state.data).then((function(e){window.location=n.props.location.state?n.props.location.state.toPage.pathname:"/movie"})).catch((function(e){n.setState((function(t){return t.error={username:e.response.data}}))}))},z.isAuthed&&n.props.history.push("/movie"),n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){console.log(this.props.location)}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(j.a,null),r.a.createElement("h1",null,"Login"),r.a.createElement("form",{onSubmit:this.handleSubmit},this.renderInput("username","Username"),this.renderInput("password","Password","password"),this.renderButton("Login")))}}]),t}(M),T=n(18),D=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={data:{username:"aaa@aaa",password:"aaaaa",name:"aaa"},error:{}},n.schema={username:N.a.string().email().required().label("Username"),password:N.a.string().min(3).required().label("Password"),name:N.a.string().required().label("Name")},n.doSubmit=function(){z.registerUser(n.state.data).then((function(e){window.location="/movie"})).catch((function(e){var t=/"([\w]+)"/,a=Object(g.a)({},n.state.error);a[e.response.data.match(t)?e.response.data.match(t)[1]:"username"]=e.response.data,n.setState((function(e){return e.error=a}))}))},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return z.isAuthed?r.a.createElement(T.a,{to:"/movie"}):r.a.createElement("div",null,r.a.createElement(j.a,null),r.a.createElement("h1",null,"Register"),r.a.createElement("form",{onSubmit:this.handleSubmit},this.renderInput("username","Username"),this.renderInput("password","Password","password"),this.renderInput("name","Name"),this.renderButton("Register")))}}]),t}(M),F=n(59),U=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={data:{id:Date.now().toString(),title:"AAA",genre:"Action",stock:2,rate:6},error:{},allGenres:[]},n.schema={id:N.a.string(),title:N.a.string().min(3).required().label("Title"),stock:N.a.number().required().label("Number in Stock"),rate:N.a.number().required().label("Rate")},n.componentWillMount=function(){if(n.schema.genre||G.getGenres().then((function(e){var t;Object.assign(n.schema,{genre:(t=N.a.string().required()).valid.apply(t,Object(F.a)(e)).label("Genre")}),n.setState((function(t){return t.allGenres=e}))})),"new"===n.props.match.params.id)return null;P.getMovie(n.props.match.params.id).then((function(e){if(!e)return console.log(n.props),n.props.history.replace("/not-found");n.setState((function(t){return t.data={id:e._id,title:e.tittle,genre:e.genres.name,stock:e.stock,rate:e.dailyRentalRate}}))}))},n.componentDidMount=function(){},n.doSubmit=function(){24===n.state.data.id.length?P.updateMovie(n.state.data).then((function(e){n.props.history.push("/movie")})):P.postMovie(n.state.data).then((function(e){n.props.history.push("/movie")})).catch((function(e){var t=Object(g.a)({},n.state.error);t[e.response.data.match(/"([\w]+)"/)[1]]=e.response.data,n.setState((function(e){return e.error=t}))}))},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(j.a,null),r.a.createElement("h1",null,"MovieForm",this.props.match.params.id),r.a.createElement("form",{onSubmit:this.handleSubmit},this.renderInput("title","Title"),this.renderSelect("genre","Genre",this.state.allGenres,this.state.data.genre),this.renderInput("stock","Number in Stock"),this.renderInput("rate","Rate"),this.renderButton("Save")))}}]),t}(M),W=n(58),q=function(e){var t=e.showWithAuth,n=e.showWithoutAuth,a=Object(W.a)(e,["showWithAuth","showWithoutAuth"]),o=localStorage.getItem("token")?x()(localStorage.getItem("token")):"";return r.a.createElement(T.b,Object.assign({},a,{render:function(e){return o?t(e):n?n(e):r.a.createElement(T.a,{to:{pathname:"/login",state:{toPage:e.location}}})}}))},B=function(e){function t(){return Object(c.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidUpdate",value:function(e,t){console.log("updated --",t)}},{key:"componentWillUnmount",value:function(){console.log("will unmount")}},{key:"render",value:function(){var e=this;console.log("rendered --");var t=this.props.counterParams,n=t.value,a=t.id;return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-2"},r.a.createElement("span",{style:{fontSize:20},className:n>0?"badge badge-primary m-2":"badge badge-warning m-1"},0===n?"Zero":n)),r.a.createElement("div",{className:"col-10"},r.a.createElement("button",{onClick:function(){e.props.handleIncrement(a)},className:"btn btn-secondary"},"+"),r.a.createElement("button",Object.assign({onClick:function(){return e.props.handleDecrement(a)},className:"btn btn-secondary m-2 "},{disabled:!Boolean(n)}),"-"),r.a.createElement("button",{onClick:function(){return e.props.handleDelete(a)},className:"btn btn-danger"},"x"),this.props.children))}}]),t}(a.Component),L=(a.Component,function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={user:""},n.componentDidMount=function(){n.setState((function(e){return e.user=localStorage.getItem("token")?x()(localStorage.getItem("token")):""}))},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("main",{className:"container"},r.a.createElement(T.b,{path:"/",render:function(t){return r.a.createElement(h,Object.assign({},t,{user:e.state.user}))}}),r.a.createElement(T.d,null,r.a.createElement(q,{path:"/movie/:id",showWithAuth:function(e){return r.a.createElement(U,e)}}),r.a.createElement(T.b,{path:"/movie",render:function(t){return r.a.createElement(A,Object.assign({},t,{user:e.state.user}))}}),r.a.createElement(T.b,{path:"/login",render:function(e){return r.a.createElement(_,e)}}),r.a.createElement(T.b,{path:"/register",render:function(e){return r.a.createElement(D,e)}}),r.a.createElement(T.b,{path:"/not-found",render:function(e){return r.a.createElement("h1",null,"Not found")}}),r.a.createElement(T.a,{to:"/not-found"}))))}}]),t}(a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(113),n(114);l.a.render(r.a.createElement(d.a,null,r.a.createElement(L,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},60:function(e,t,n){e.exports=n(115)},65:function(e,t,n){},66:function(e,t,n){},95:function(e,t){},97:function(e,t){}},[[60,1,2]]]);
//# sourceMappingURL=main.c62f9be3.chunk.js.map